= Metanorma Lawgr: Design Document
:doctype: article
:toc: macro
:toclevels: 4

toc::[]

== Introduction

This document describes the design of *metanorma-lawgr*, a Metanorma flavour for authoring Greek legislation.

Upstream Metanorma builds on AsciiDoc to provide a model for technical specifications, standards, and other normative documents.
This project extends that model to support the specificities of Greek law, following the architectural patterns established by existing Metanorma flavours (ISO, IEC, BSI, etc.) while diverging where legislation demands it.

The design draws on:

* The official _Codification Methodology Manual_ (Εγχειρίδιο Μεθοδολογίας για την Κωδικοποίηση της Νομοθεσίας, 2020) published by the Central Codification Committee (Κ.Ε.Κ.).
* An Akoma Ntoso 3.0 sample of Law 4330/2015 (`law_4330_2015.xml`).
* The LegalParser companion (PCI 2016) which provides a context-free grammar for Greek legal documents.
* The reference Metanorma repositories: `basicdoc-models`, `metanorma-model-standoc`, `metanorma-model-iso`, `metanorma-standoc`, `metanorma-iso`, and `coradoc`.


== Greek law structural elements

Greek law consists of the following structural hierarchy, from outermost to innermost.
Titles are optional at every level except Article.

All numbering in the table below is *derived by the presentation layer* from document structure.
Authors never hardcode numbers in section titles.

[cols="2,2,3,2", options="header"]
|===
| Level | Greek name | Numbering style | Rendered example

| Book
| ΒΙΒΛΙΟ
| Greek ordinal words, uppercase neuter (ΠΡΩΤΟ, ΔΕΥΤΕΡΟ…)
| ΒΙΒΛΙΟ ΠΡΩΤΟ

| Part
| ΜΕΡΟΣ
| Uppercase Greek letter with keraia (Α', Β'…)
| ΜΕΡΟΣ Α'

| Section
| ΤΜΗΜΑ
| Uppercase Roman (I, II…)
| ΤΜΗΜΑ I

| Chapter
| ΚΕΦΑΛΑΙΟ
| Uppercase Greek letter with keraia (Α', Β'…)
| ΚΕΦΑΛΑΙΟ Α'

| Article
| Άρθρο
| Arabic, continuous across whole law
| Άρθρο 1

| Subarticle
| Υποάρθρο
| Arabic, dot-separated from article (e.g. 1.1)
| —

| Paragraph
| Παράγραφος
| Arabic within article (1, 2…); optionally dot-separated from article via `:inheritnumbering:` (5.1, 5.2…); hidden when article has only one
| 1.

| Custom
| —
| Uppercase Greek letter + period (Α., Β., Γ.…); resets per parent; NOT inherited by children
| Α. Φυσική Πρόσβαση
|===

Paragraphs may *nest recursively*.
A paragraph can contain both text and child paragraphs, each of which may in turn contain further child paragraphs.
For example, Article 5 → Subarticle 5.2 → Paragraph 5.2.8 → Paragraph 5.2.8.1 → Paragraph 5.2.8.1.1 is a valid structure.

NOTE: *Subarticle* (Υποάρθρο) is not a normative element but is seen in practice when articles are divided into discrete sections bearing optional titles.
It affects paragraph numbering and must be modellable.

NOTE: *Custom* is a non-normative grouping clause used for labelled sub-sections (e.g. "Α. Φυσική Πρόσβαση") within subarticles or paragraphs.
Its numbering uses uppercase Greek letters that reset per parent container and are *not* inherited by child paragraphs — children continue the parent's paragraph numbering sequence transparently.

=== Structural numbering rule

All numbering labels (at every level) are *derived by the presentation layer* from element position in the document tree.
Authors provide only optional descriptive titles; the converter generates the numbering prefix.

==== Book ordinals

Books are numbered with Greek ordinal words in the neuter gender.
The presentation layer provides a built-in lookup table.
The `twitter_cldr` gem (already used by `metanorma-un` for English ordinals) supports Greek locale and may be able to generate these programmatically; this should be evaluated during implementation as an alternative to a hardcoded table.

[cols="1,2", options="header"]
|===
| Position | Ordinal

| 1 | ΠΡΩΤΟ
| 2 | ΔΕΥΤΕΡΟ
| 3 | ΤΡΙΤΟ
| 4 | ΤΕΤΑΡΤΟ
| 5 | ΠΕΜΠΤΟ
| 6 | ΕΚΤΟ
| 7 | ΕΒΔΟΜΟ
| 8 | ΟΓΔΟΟ
| 9 | ΕΝΑΤΟ
| 10 | ΔΕΚΑΤΟ
|===

For positions beyond the table (rare in practice), the author can override via the `ordinal` attribute:

[source,asciidoc]
----
[heading=book,ordinal=ΕΝΔΕΚΑΤΟ]
= Ειδικές διατάξεις
----

This renders as: *ΒΙΒΛΙΟ ΕΝΔΕΚΑΤΟ: Ειδικές διατάξεις*

==== Part, Section, Chapter, Article

* *Part* (ΜΕΡΟΣ): uppercase Greek letter with keraia, derived from position (Α', Β', Γ'…)
* *Section* (ΤΜΗΜΑ): uppercase Roman numeral, derived from position (I, II, III…)
* *Chapter* (ΚΕΦΑΛΑΙΟ): uppercase Greek letter with keraia, derived from position (Α', Β', Γ'…)
* *Article* (Άρθρο): Arabic numeral, continuous across the whole law, derived from position

All four use the `{``empty``}` or descriptive-title-only convention.
The `number` attribute (inherited from StanDoc) can override auto-numbering when needed (e.g. for amendment documents that must follow an existing article scheme).

==== Paragraph numbering

By default, paragraphs are numbered with *flat Arabic numerals* within each article: 1, 2, 3…
Organisational levels (Book, Part, Section, Chapter) are never incorporated into paragraph numbering.

The document attribute `:inheritnumbering: true` switches to *hierarchical dot-separated* numbering, where each paragraph’s label is prefixed with its article number:

* Default (flat): 1., 2., 3.…
* `:inheritnumbering: true`: 5.1., 5.2., 5.3.…

With hierarchical numbering enabled and deeper nesting, the full ancestry is reflected:
____
ΒΙΒΛΙΟ ΠΡΩΤΟ → ΜΕΡΟΣ Α’ → ΚΕΦΑΛΑΙΟ Β’ → Άρθρο 5 → Υποάρθρο 5.2 → Παράγραφος 5.2.8 → Παράγραφος 5.2.8.1 → Παράγραφος 5.2.8.1.1
____
The displayed number of the deepest paragraph is *5.2.8.1.1* — the Book, Part, and Chapter numbers play no role.

The numbering components are: `{article}.{subarticle?}.{para}.{sub-para}…`

The `:inheritnumbering:` attribute is stored in the XML as `<ext><inheritnumbering>true</inheritnumbering></ext>` and read by `IsoDoc::Lawgr::Xref` during the numbering phase.

=== Sub-paragraph enumeration

Within a paragraph, ordered enumerations follow a strict three-level scheme:

[cols="2,2,3,3", options="header"]
|===
| Level | Greek name | Numbering | Notes

| 1st (case)
| περίπτωση
| Proper Greek lowercase numerals (α, β… στ, ζ… ι, ια…)
| See <<greek-numerals>> for algorithm

| 2nd (subcase)
| υποπερίπτωση
| Double Greek lowercase — first letter = parent, second = ordinal (αα, αβ… βα, ββ…)
| Merges with parent number in presentation

| 3rd (element)
| στοιχείο
| Lowercase Latin (i, ii, iii…)
| Standard AsciiDoc `lowerroman` suffices
|===

No further levels are formally defined, but may be used in practice.

When an article has a single paragraph, the paragraph number is suppressed in rendered output.

Each grammatical sentence within a paragraph is called an *εδάφιο* (or informally *περίοδος*).
Amendments may reference specific εδάφια (see <<edafio-annotation>>).

Multiple ordered lists within a single paragraph are not normatively defined but occur in practice.
We assign implicit ordinals to such lists (list 1, list 2) so they can be referenced.

=== Semantic text body sections

The text body of a codified law is divided into semantically distinct ordered categories.
Each may contain any elements from the structural hierarchy above.

. *Γενικές διατάξεις* — General provisions (scope, definitions, general principles)
. *Ουσιαστικές διατάξεις* — Substantive provisions
. *Οργανωτικές και διαδικαστικές διατάξεις* — Organisational, procedural provisions and deadlines
. *Ποινικές και διοικητικές κυρώσεις / δικονομικές διατάξεις* — Penal/administrative sanctions and procedural provisions
. *Εξουσιοδοτικές διατάξεις* — Delegating provisions
. *Μεταβατικές διατάξεις* — Transitional provisions
. *Καταργούμενες / διατηρούμενες διατάξεις* — Repealed/retained provisions
. *Έναρξη ισχύος* — Entry into force

=== Document parts

In addition to the text body, a Greek law may have:

* *Introductory part* (coverpage, preface, preamble) — modelled as Metanorma `preface` sections
* *Endpart* (conclusions, signatures) — modelled as Metanorma `colophon` sections

The internal structure of these is not rigidly defined; we assume they may contain any structural elements, similarly to the text body.


== Architecture decisions

=== Model inheritance

After examining how `metanorma-iso` extends `metanorma-standoc`, and how `metanorma-standoc` extends `basicdoc-models`:

* *Inherit directly from StanDoc, not from ISO.*
Greek law is not an ISO-family standard.
ISO's model adds ISO-specific metadata (stages, TC/SC/WG, document schemes) that are irrelevant to legislation.
* *Reuse from StanDoc:*
** `StandardDocument` structure (bibdata, preface, sections, annex, bibliography, colophon)
** `ClauseSection` with its `type` attribute — this is how we distinguish structural levels
** `StandardSection` with its `number`, `unnumbered`, and `inline-header` attributes
** All BasicBlock types (paragraphs, tables, figures, notes, admonitions, ordered/unordered lists, etc.)
** All TextElement inline types
** The cleanup, validation, and rendering pipeline architecture
* *Extend for lawgr:*
** Custom section types for the Greek law hierarchy
** Custom ordered-list types for Greek numeral schemes
** Greek law-specific metadata (ΦΕΚ number, law type, signers, etc.)
** Greek i18n labels

=== Toolchain

*Ruby*, matching the existing Metanorma ecosystem.

The gem is `metanorma-lawgr` and follows the same structure as `metanorma-iso`:

* `lib/metanorma/lawgr/` — AsciiDoc→XML converter (inheriting `Metanorma::Standoc::Converter`)
* `lib/isodoc/lawgr/` — XML→HTML/PDF renderer (inheriting `IsoDoc::HtmlConvert`, `IsoDoc::PresentationXMLConvert`)
* `lib/metanorma-lawgr.rb` — entry point, Metanorma registry registration

=== Grammar / schema

Following the pattern documented in `metanorma-model-iso/README.adoc`:

* `lawgr.rnc` — extends `isodoc.rnc` (the base Metanorma grammar, *not* `isostandard.rnc`)
* `relaton-lawgr.rnc` — extends `biblio-standoc.rnc` with Greek law metadata fields
* `lawgr-compile.rnc` — wraps `lawgr.rnc` and `relaton-lawgr.rnc`

This is the documented pattern for non-ISO Metanorma flavours:
____
`{FLAVOUR}.rnc` extends `isodoc.rnc` to a Metanorma flavour that does not inherit from ISO.
____

=== Output formats

* *Primary:* HTML (via `IsoDoc::Lawgr::HtmlConvert`)
* *Deferred:* PDF (via XSL-FO / `IsoDoc::Lawgr::PdfConvert`) — removed from the prototype processor


== AsciiDoc authoring syntax

The syntax follows standard Metanorma AsciiDoc conventions.
AsciiDoc section depth maps to the structural hierarchy, disambiguated by `heading` attributes where needed.

=== Section depth and nesting limits

Standard Asciidoctor supports 6 section levels (`=` through `======`, levels 0–5).
The XML model has no depth limit — `<clause>` elements nest arbitrarily.
The constraint is purely at the AsciiDoc syntax layer.

==== The `level` attribute for deep nesting

Metanorma's StanDoc provides a built-in mechanism for sections deeper than 5 levels: the `level` attribute.
All sections beyond level 5 are written with `======` (the deepest AsciiDoc syntax), and the `[level=N]` attribute declares the actual desired depth.
During the cleanup phase, StanDoc's `sections_level_cleanup` rearranges these flat sibling sections into the correct nested structure by moving each clause with `level >= 6` inside its preceding sibling.

This is the *primary mechanism* for deep nesting in lawgr and requires no parser extensions.

In practice, most Greek laws do *not* use all organisational levels (Book, Part, Section, Chapter) simultaneously.
Typical combinations and their depth budgets:

[cols="3,1", options="header"]
|===
| Typical structure | AsciiDoc levels used

| Chapter → Article → Paragraph → nested paragraphs
| 4–5 levels (no `level` attribute needed)

| Article → Subarticle → Paragraph → nested paragraphs
| 4–5 levels (no `level` attribute needed)

| Book → Part → Chapter → Article → Paragraph → nested paragraphs
| 6+ levels (use `level` attribute for depth > 5)
|===

Example with deep nesting:

[source,asciidoc]
----
[heading=book]
= {empty}

[heading=part]
== {empty}

[heading=chapter]
=== {empty}

[heading=article]
==== {empty}

[heading=subarticle]
===== Λογική πρόσβαση

[heading=paragraph]
====== {empty}

Ο πάροχος διατηρεί και εφαρμόζει τις παρακάτω διαδικασίες:

[level=7,heading=paragraph]
====== Διαδικασία Διαχείρισης Χρηστών ΠΕΣ

[level=8,heading=paragraph]
====== {empty}

Στη Διαδικασία Διαχείρισης Χρηστών ΠΕΣ περιγράφεται με σαφήνεια
ο τρόπος προσθήκης νέων χρηστών ΠΕΣ...

[level=8,heading=paragraph]
====== {empty}

Για κάθε μία εκ των ενεργειών...

[level=7,heading=paragraph]
====== Διαδικασία Ελέγχου Ορθής Εφαρμογής

[level=8,heading=paragraph]
====== {empty}

Στη Διαδικασία Ελέγχου Ορθής Εφαρμογής...

[heading=paragraph]
====== {empty}

Ο πάροχος εφαρμόζει...
----

All sections beyond level 5 use `======` syntax but declare their actual depth via `[level=N]`.
StanDoc's cleanup phase rearranges them into the correct nesting.

==== File-per-article with `leveloffset` (optional)

As an alternative authoring pattern, large laws can split articles into separate files and use Asciidoctor's `leveloffset` on `include::` directives.
`leveloffset` adjusts the effective `node.level` after syntax parsing, so each included file can start at level 0 while being placed at the correct depth in the parent.

[source,asciidoc]
----
// parent.adoc
[heading=chapter]
=== {empty}

\include::articles/article5.adoc[leveloffset=+3]
\include::articles/article6.adoc[leveloffset=+3]
----

[source,asciidoc]
----
// articles/article5.adoc — self-contained, starts at level 0
[heading=article]
= {empty}

[heading=subarticle]
== Λογική πρόσβαση

[heading=paragraph]
=== {empty}

[heading=paragraph]
==== Διαδικασία Διαχείρισης Χρηστών ΠΕΣ

[heading=paragraph]
===== {empty}

Στη Διαδικασία Διαχείρισης Χρηστών ΠΕΣ...
----

This pattern improves authoring ergonomics for large laws and avoids the need for `level` attributes entirely, since each file has its full 6-level budget.
The two mechanisms (`level` attribute and `leveloffset`) can be combined as needed.

=== Document header

[source,asciidoc]
----
= ΝΟΜΟΣ ΥΠ' ΑΡΙΘ. 4330: Τροποποίηση διατάξεων Κώδικα Φορολογίας Εισοδήματος και άλλες διατάξεις
:docnumber: 4330
:doctype: act
:copyright-year: 2015
:published-date: 2015-06-16
:language: el
:script: Grek
:fek-number: 59
:fek-series: Α'
:fek-year: 2015
:publisher: ΕΘΝΙΚΟ ΤΥΠΟΓΡΑΦΕΙΟ
:mn-document-class: lawgr
:inheritnumbering: true
----

NOTE: `:inheritnumbering: true` is optional.
When set, paragraph numbering becomes hierarchical (e.g. 5.1., 5.2.) instead of flat (1., 2.).
See <<Paragraph numbering>>.

=== Structural sections

Section depth determines the structural level.
The `heading` attribute may be used to explicitly declare the type when section depth alone is ambiguous.

[source,asciidoc]
----
[heading=book]
= Γενικές διατάξεις

[heading=part]
== Πεδίο εφαρμογής

[heading=section]
=== Ορισμοί

[heading=chapter]
==== Βασικοί ορισμοί

[heading=article]
===== Σκοπός

Σκοπός του παρόντος είναι...

[heading=article]
===== Πεδίο εφαρμογής

[heading=paragraph]
====== {empty}

Ο παρών κώδικας εφαρμόζεται...

[heading=paragraph]
====== {empty}

Εξαιρούνται...
----

This renders as:
____
*ΒΙΒΛΙΟ ΠΡΩΤΟ: Γενικές διατάξεις* +
ΜΕΡΟΣ Α': Πεδίο εφαρμογής +
ΤΜΗΜΑ I: Ορισμοί +
ΚΕΦΑΛΑΙΟ Α': Βασικοί ορισμοί +
Άρθρο 1: Σκοπός +
Άρθρο 2: Πεδίο εφαρμογής — 1. Ο παρών… 2. Εξαιρούνται…
____

=== Skipped organisational levels

Not all laws use every organisational level.
The `heading` attribute disambiguates each element's type regardless of which levels are present.
The presentation layer numbers each level independently — skipped levels simply don't appear.

==== Parts only (no Books, no Chapters)

[source,asciidoc]
----
[heading=part]
== Γενικές διατάξεις

[heading=article]
=== Σκοπός

Σκοπός του παρόντος είναι...

[heading=article]
=== Πεδίο εφαρμογής

...

[heading=part]
== Ειδικές διατάξεις

[heading=article]
=== Φορολογικές ρυθμίσεις

...
----

This renders as:
____
ΜΕΡΟΣ Α': Γενικές διατάξεις +
Άρθρο 1: Σκοπός +
Άρθρο 2: Πεδίο εφαρμογής +
ΜΕΡΟΣ Β': Ειδικές διατάξεις +
Άρθρο 3: Φορολογικές ρυθμίσεις
____

==== Parts with mixed structure (some Parts have Chapters, some do not)

[source,asciidoc]
----
[heading=part]
== Γενικές διατάξεις

// Articles directly under Part — no chapters here
[heading=article]
=== Σκοπός

...

[heading=article]
=== Ορισμοί

...

[heading=part]
== Ειδικές διατάξεις

// This Part has Chapters
[heading=chapter]
=== Φορολογία εισοδήματος

[heading=article]
==== Φορολογητέο εισόδημα

...

[heading=article]
==== Φορολογικοί συντελεστές

...

[heading=chapter]
=== Φόρος Προστιθέμενης Αξίας

[heading=article]
==== Αντικείμενο του φόρου

...
----

This renders as:
____
ΜΕΡΟΣ Α': Γενικές διατάξεις +
Άρθρο 1: Σκοπός +
Άρθρο 2: Ορισμοί +
ΜΕΡΟΣ Β': Ειδικές διατάξεις +
ΚΕΦΑΛΑΙΟ Α': Φορολογία εισοδήματος +
Άρθρο 3: Φορολογητέο εισόδημα +
Άρθρο 4: Φορολογικοί συντελεστές +
ΚΕΦΑΛΑΙΟ Β': Φόρος Προστιθέμενης Αξίας +
Άρθρο 5: Αντικείμενο του φόρου
____

NOTE: Because Articles are numbered continuously across the whole law, Articles under Part Α' (which has no chapters) and Articles under Part Β' / Chapter Α' all share one continuous sequence.
The `heading` attribute ensures the converter places each element at the correct structural type, even though the AsciiDoc nesting depth differs between the two Parts.

=== Articles and paragraphs

An article is the fundamental unit.
Paragraphs within an article are numbered subsections.
Paragraphs may nest recursively — child paragraphs are modelled as subsections of their parent paragraph.

NOTE: *Numbers are never hardcoded* in section titles at any level.
The presentation layer derives all numbering from document structure (see <<Structural numbering rule>>).
Authors provide only optional *descriptive titles*; untitled elements use `{``empty``}` as the section title.

Simple case (flat paragraphs):

[source,asciidoc]
----
[heading=article]
== Υποχρεώσεις τρίτων

[heading=paragraph]
=== {empty}

Η παρ. 1 του άρθρου 54Α του Ν. 4174/2013 αντικαθίσταται ως ακολούθως...

[heading=paragraph]
=== {empty}

Οι τυχόν παραλείψεις ή σφάλματα...
----

When an article has a single paragraph, use `[%unnumbered]`:

[source,asciidoc]
----
[heading=article]
== {empty}

[%unnumbered,heading=paragraph]
=== {blank}

Υπόχρεος για την απόδοση του Φόρου Προστιθέμενης Αξίας...
----

=== Deeply nested paragraphs

Paragraphs nest to arbitrary depth.
The `heading=paragraph` attribute ensures the converter treats every level as a paragraph regardless of AsciiDoc depth.

When the article stands alone (no organisational levels above), plain section nesting suffices:

[source,asciidoc]
----
[heading=article]
== {empty}

[heading=subarticle]
=== Λογική πρόσβαση

[heading=paragraph]
==== {empty}

Ο πάροχος διατηρεί και εφαρμόζει τις παρακάτω διαδικασίες:

[heading=paragraph]
===== Διαδικασία Διαχείρισης Χρηστών ΠΕΣ

[heading=paragraph]
====== {empty}

Στη Διαδικασία Διαχείρισης Χρηστών ΠΕΣ περιγράφεται με σαφήνεια
ο τρόπος προσθήκης νέων χρηστών ΠΕΣ...

[heading=paragraph]
====== {empty}

Για κάθε μία εκ των ενεργειών...
----

When organisational levels consume the upper AsciiDoc section tiers, use the `level` attribute or file-per-article with `leveloffset` to go deeper — see <<The `level` attribute for deep nesting>> and <<File-per-article with `leveloffset` (optional)>>.

The displayed paragraph numbers (5.2.8.1.1, 5.2.8.2.2, etc.) are derived from the article/subarticle/paragraph ancestry — see <<Paragraph numbering rule>>.

=== Custom clauses

Custom clauses group related paragraphs under a labelled sub-heading (e.g. "Α. Φυσική Πρόσβαση") without affecting the paragraph numbering chain.
They are typically used inside subarticles or paragraphs. These are non-normative, but have been seen in the wild (especially in regulatory texts).

[source,asciidoc]
----
[heading=subarticle]
==== Φυσική Πρόσβαση και Περιβαλλοντική Ασφάλεια

[heading=custom]
===== Φυσική Πρόσβαση

[heading=paragraph]
====== {empty}

Ο πάροχος καθορίζει τα απαιτούμενα μέτρα...

[heading=paragraph]
====== {empty}

Ο πάροχος διαθέτει και εφαρμόζει διαδικασία...

[heading=custom]
===== Περιβαλλοντική Ασφάλεια

[heading=paragraph]
====== {empty}

Ο πάροχος εκτιμά και αντιμετωπίζει τους κινδύνους...
----

This renders as:
____
5.1. Φυσική Πρόσβαση και Περιβαλλοντική Ασφάλεια +
{nbsp}{nbsp}Α. Φυσική Πρόσβαση +
{nbsp}{nbsp}{nbsp}{nbsp}5.1.1. Ο πάροχος καθορίζει… +
{nbsp}{nbsp}{nbsp}{nbsp}5.1.2. Ο πάροχος διαθέτει… +
{nbsp}{nbsp}Β. Περιβαλλοντική Ασφάλεια +
{nbsp}{nbsp}{nbsp}{nbsp}5.1.3. Ο πάροχος εκτιμά…
____

Key behaviours:

* Numbering uses uppercase Greek letters from `GREEK_UPPER_LETTERS` (Α, Β, Γ…), resetting per parent container
* The custom clause's numbering is *not* inherited by children — child paragraphs continue the parent's paragraph counter (5.1.1, 5.1.2 under Α; 5.1.3 under Β)
* Custom clauses can be optional-titled; the label renders as "Α. Title" or just "Α." if untitled
* Children are rendered with cascading indentation (see <<Cascading indentation>>)

=== Sub-paragraph enumerations (περίπτωση / υποπερίπτωση / στοιχείο)

Ordered lists within paragraphs map to the three-level scheme.
Custom list styles are used:

[source,asciidoc]
----
[heading=paragraph]
====== {empty}

Εισαγωγικό εδάφιο:

[lowergreek]
. πρώτη περίπτωση
.. πρώτη υποπερίπτωση
.. δεύτερη υποπερίπτωση
... πρώτο στοιχείο (lowerroman automatically)
... δεύτερο στοιχείο
. δεύτερη περίπτωση
. τρίτη περίπτωση
----

The `lowergreek` style triggers the proper Greek numeral algorithm (see <<greek-numerals>>).
Nesting depth determines the sub-paragraph level:

* Depth 1 → περίπτωση (proper Greek lowercase: α, β… στ, ζ… ι, ια…)
* Depth 2 → υποπερίπτωση (double Greek: αα, αβ… βα, ββ…)
* Depth 3 → στοιχείο (lowercase Latin/Roman: i, ii, iii…)

=== Semantic text body sections

Use the `type` attribute on top-level body clauses:

[source,asciidoc]
----
[type=general-provisions]
== Γενικές διατάξεις

...

[type=substantive-provisions]
== Ουσιαστικές διατάξεις

...

[type=transitional-provisions]
== Μεταβατικές διατάξεις

...

[type=entry-into-force]
== Έναρξη ισχύος

...
----

==== Combining `heading` and `type`

When a structural element also carries a semantic classification, both attributes can be specified:

[source,asciidoc]
----
[heading=article,type=entry-into-force]
== Έναρξη ισχύος
----

The `heading` attribute always determines the *structural type* (`type="article"` in the XML).
The user-specified `type` is preserved as a separate `semantic-type` attribute (`semantic-type="entry-into-force"` in the XML).
This ensures the element is correctly recognised for numbering and rendering while retaining its semantic classification.

=== Preface and conclusions

[source,asciidoc]
----
[.preface]
== Εκδίδομε τον ακόλουθο νόμο

Ο ΠΡΟΕΔΡΟΣ ΤΗΣ ΕΛΛΗΝΙΚΗΣ ΔΗΜΟΚΡΑΤΙΑΣ
...

// Main body here

[.colophon]
== Υπογραφές

Αθήνα, 16 Ιουνίου 2015 +
Ο ΠΡΟΕΔΡΟΣ ΤΗΣ ΔΗΜΟΚΡΑΤΙΑΣ +
ΠΡΟΚΟΠΙΟΣ Β. ΠΑΥΛΟΠΟΥΛΟΣ
----

=== Cross-references

Internal references within the same document use standard `xref`:

[source,asciidoc]
----
Σύμφωνα με το <<art-5-para-1>> του παρόντος...
----

References to other laws authored in the same flavour use `eref`:

[source,asciidoc]
----
Σύμφωνα με το eref:[4172-2013,clause=72]{Ν. 4172/2013, Άρθρο 72}...
----

No external database fetching is implemented.
Bibliography entries for referenced laws are authored manually in a `[bibliography]` section.


[[greek-numerals]]
== Greek numeral system

Standard AsciiDoc's `lowergreek` cycles through the Greek alphabet (α, β, γ, δ, ε, ζ…) which is incorrect for Greek legal numbering.

Greek law uses *proper Greek lowercase numerals* which are a positional system:

[cols="1,1,3", options="header"]
|===
| Value | Numeral | Notes

| 1–5 | α, β, γ, δ, ε |
| 6 | στ | digraph, not ζ
| 7–9 | ζ, η, θ |
| 10 | ι |
| 11–15 | ια, ιβ, ιγ, ιδ, ιε |
| 16 | ιστ | digraph at ones position
| 17–19 | ιζ, ιη, ιθ |
| 20 | κ |
| 21 | κα |
| … | … |
|===

The algorithm:

. Ones: α=1, β=2, γ=3, δ=4, ε=5, στ=6, ζ=7, η=8, θ=9
. Tens: ι=10, κ=20, λ=30, μ=40, ν=50, ξ=60, ο=70, π=80, (ϟ=90 — rarely needed)
. Combine: tens + ones, e.g. 16 = ι + στ = ιστ, 23 = κ + γ = κγ

For uppercase variant, the same letters are capitalised.

=== Double Greek (υποπερίπτωση)

The first letter identifies the parent περίπτωση, the second is the ordinal within the parent:

* Parent α: αα, αβ, αγ…
* Parent β: βα, ββ, βγ…
* Parent στ: στα, στβ, στγ…

NOTE: When the parent is a digraph (στ), the prefix is also the digraph, so υποπερίπτωση entries under στ are: στα, στβ, στγ, etc.

=== Implementation

Two new ordered-list types are added to the Metanorma `ol` vocabulary:

* `greek_lower` — proper Greek lowercase numerals (for περίπτωση)
* `greek_lower_double` — double Greek (for υποπερίπτωση, auto-prefixed with parent)

These are rendered by `IsoDoc::Lawgr::PresentationXMLConvert#ol_depth`, which selects the type based on nesting depth within a paragraph context.

A utility module `Metanorma::Lawgr::GreekNumerals` implements:

[source,ruby]
----
module Metanorma
  module Lawgr
    module GreekNumerals
      ONES = ["", "α", "β", "γ", "δ", "ε", "στ", "ζ", "η", "θ"].freeze
      TENS = ["", "ι", "κ", "λ", "μ", "ν", "ξ", "ο", "π", "ϟ"].freeze

      def self.to_greek_lower(n)
        return "" if n <= 0
        tens = n / 10
        ones = n % 10
        "#{TENS[tens]}#{ONES[ones]}"
      end

      def self.to_greek_upper(n)
        to_greek_lower(n).upcase
      end

      def self.to_greek_double(parent_n, child_n)
        "#{to_greek_lower(parent_n)}#{to_greek_lower(child_n)}"
      end
    end
  end
end
----


== Document model

=== LawgrDocument

`LawgrDocument` extends `StandardDocument` from StanDoc.

[source]
----
class LawgrDocument < StandardDocument
  +bibdata: LawgrBibliographicItem
  +preface: LawgrPreface[0..1]
  +sections: LawgrSections
  +colophon: StandardHierarchicalSection[0..*]
end
----

=== LawgrBibliographicItem

Extends `StandardBibData` with Greek law metadata:

[source]
----
class LawgrBibliographicItem < StandardBibData
  +fek-number: String[0..1]           // ΦΕΚ issue number (e.g. "59")
  +fek-series: String[0..1]           // ΦΕΚ series (Α', Β', etc.)
  +fek-year: String[0..1]             // ΦΕΚ year of publication
  +signers: LawgrSigner[0..*]         // Signers with role
end
----

=== LawgrDocumentType

The `:doctype:` attribute classifies the legal document.
These correspond to the principal categories of documents published in the Official Gazette (ΦΕΚ):

[source]
----
enum LawgrDocumentType {
  act                   // Νόμος (Law / Act of Parliament)
  pd                    // Προεδρικό Διάταγμα (Presidential Decree)
  ap                    // Πράξη Κανονιστικού Χαρακτήρα (Regulatory Act)
  egk                   // Εγκύκλιος (Information Circular)
  other                 // Λοιπά Νομικά Έγγραφα (Other Legal Documents)
}
----

In the document header, use:

[source,asciidoc]
----
:doctype: act
----

=== LawgrSections

[source]
----
class LawgrSections
  +clause: LawgrClause[1..*]    // structural hierarchy elements
end
----

=== LawgrClause

Reuses StanDoc's `ClauseSection` with `type` constrained to:

[cols="2,3", options="header"]
|===
| type value | Structural element

| `book` | ΒΙΒΛΙΟ
| `part` | ΜΕΡΟΣ
| `tmima` | ΤΜΗΜΑ (Section)
| `chapter` | ΚΕΦΑΛΑΙΟ
| `article` | Άρθρο
| `subarticle` | Υποάρθρο
| `paragraph` | Παράγραφος
| `custom` | Non-normative grouping clause (Α., Β., Γ.…)
|===

The `type` attribute is always a *structural* type derived from the `heading` attribute.
When the AsciiDoc source also specifies a `type` attribute (e.g. `[heading=article,type=entry-into-force]`), the structural type takes precedence and the user-specified type is stored as `semantic-type`.

Recognised `semantic-type` values:

[cols="2,3", options="header"]
|===
| semantic-type value | Semantic category

| `general-provisions` | Γενικές διατάξεις
| `substantive-provisions` | Ουσιαστικές διατάξεις
| `organisational-provisions` | Οργανωτικές και διαδικαστικές διατάξεις
| `sanctions` | Ποινικές/διοικητικές κυρώσεις
| `delegating-provisions` | Εξουσιοδοτικές διατάξεις
| `transitional-provisions` | Μεταβατικές διατάξεις
| `repealed-provisions` | Καταργούμενες/διατηρούμενες διατάξεις
| `entry-into-force` | Έναρξη ισχύος
|===


== Rendering

=== Pipeline

The rendering pipeline follows standard Metanorma architecture:

. *AsciiDoc source* → `Metanorma::Lawgr::Converter` → *Semantic XML*
. *Semantic XML* → `IsoDoc::Lawgr::PresentationXMLConvert` → *Presentation XML*
. *Presentation XML* → `IsoDoc::Lawgr::HtmlConvert` → *HTML*
. *Presentation XML* → `IsoDoc::Lawgr::PdfConvert` → *PDF* (deferred)

=== Presentation XML customisations

`IsoDoc::Lawgr::PresentationXMLConvert` overrides:

* `ol_depth` — selects list type based on nesting depth: depth 1 → `:lowergreek` (proper Greek lowercase numerals α, β… στ, ζ… ι, ια…); depth 2+ → `:roman`
* `ol_label_template` — adds `:lowergreek` format template (`%)`)
* `clause1` — dispatches to structural label methods based on clause `type`: `prefix_structural_label`, `prefix_article_label`, `prefix_subarticle_label`, `prefix_custom_label`, `prefix_paragraph_label`
* `add_toc_variant_title` — injects `<variant-title type="toc">` for untitled paragraphs (showing "Παράγραφος _n_") and untitled articles (showing "Άρθρο _n_") so the navigation sidebar displays meaningful labels instead of bare numbers
* `single_paragraph_suppression` — suppresses paragraph numbering when an article has only one paragraph *(not yet implemented)*
** workaround: write body directly under article, without introducing a [type=paragraph] section

`IsoDoc::Lawgr::Xref` overrides:

* `main_anchor_names` — reads `:inheritnumbering:` from document metadata, then dispatches to `lawgr_section_names`
* `lawgr_article_names` — numbers articles sequentially across the whole law
* `lawgr_subarticle_names` — numbers subarticles within articles and dispatches to child paragraphs and custom clauses
* `lawgr_paragraph_names` — numbers paragraphs within each article; supports flat (default) and hierarchical (`:inheritnumbering:`) modes
* `lawgr_custom_names` / `lawgr_custom_anchor` — assigns uppercase-Greek numbering to custom clauses; the parent's paragraph counter is passed through transparently so child paragraphs continue the parent sequence
* `list_item_value` — overrides base method to produce proper Greek lowercase numerals for `:lowergreek` ordered lists, calling `GreekNumerals.to_greek_lower` instead of `Counter#listlabel`

`IsoDoc::Lawgr::BaseConvert` overrides:

* `clause_attrs` — adds CSS classes (`lawgr-article`, `lawgr-paragraph`, `lawgr-custom`, etc.) to clause `<div>` elements based on the XML `type` attribute; also sets CSS custom properties for cascading indentation (see <<Cascading indentation>>)
* `precompute_paragraph_widths` — scans all paragraph, subarticle, and custom labels in the presentation XML before rendering to compute maximum label widths per numbering depth; stores them as `@paragraph_indent_by_segments`, `@subarticle_max_num_width`, and `@custom_max_num_width`
* `ol_attrs` — suppresses native `<ol>` numbering for `:lowergreek` lists (sets `list-style: none`)
* `li_parse` — renders `<fmt-name>` content as inline `<span class="ol-label">` for `:lowergreek` list items (the base converter skips `fmt-name` because standard types use native browser numbering)

=== i18n

`i18n-el.yaml` provides Greek labels:

[source,yaml]
----
clause: Διάταξη
book: Βιβλίο
part: Μέρος
section: Τμήμα
chapter: Κεφάλαιο
article: Άρθρο
subarticle: Υποάρθρο
paragraph: Παράγραφος
case: περίπτωση
subcase: υποπερίπτωση
element: στοιχείο
edafio: εδάφιο
table_of_contents: Πίνακας Περιεχομένων
----

=== HTML output

Custom HTML template and plain CSS stylesheet (`htmlstyle.css`) providing:

* *Font:* Inter (Google Fonts), with system sans-serif fallbacks
* *Navigation sidebar:* fixed left sidebar with table of contents generated server-side from heading elements; toggle button to collapse/expand; paragraph TOC entries show "Παράγραφος _n_" via `variant-title` mechanism
* *Hanging-indent paragraph layout:* paragraph numbers float left in a gutter; the first content block flows inline next to the number; subsequent blocks maintain the same left indent (CSS class `lawgr-paragraph`); numbers are *left-aligned* within their gutter for correct cross-level alignment
* *Structural labels:* uppercase centred rendering for top-level elements (ΒΙΒΛΙΟ, ΜΕΡΟΣ, ΤΜΗΜΑ, ΚΕΦΑΛΑΙΟ); centred article headings
* *Cascading indentation:* CSS custom properties (`--lawgr-sub-num-width`, `--lawgr-custom-num-width`, `--lawgr-num-width`) set per-`div` by `clause_attrs` control the hanging-indent width at each level; nested elements inherit the parent's content position so each child's numbering starts where the parent's text begins (see <<Cascading indentation>>)
* *Deep paragraph headings (h7, h8):* since HTML only defines `h1`–`h6`, deeper paragraph headings are rendered as `<h7>` / `<h8>` (unknown elements); the CSS adds `display: block` and the same float/indent rules as standard headings
* *Navbar toggle:* `scripts_override.html` replaces the base isodoc toggle script with a unified handler that (a) slides the `nav` panel via CSS `left` animation, (b) animates the toggle button position in sync, and (c) maintains a minimum body `margin-left` (toggle width + gap) when collapsed, so content never overlaps the widget. The base handler is removed first via `$('#toggle').off('click')` to prevent double animation
* *Cover page:* template with ΦΕΚ publication metadata
* *Responsive:* sidebar collapses on narrow viewports; print styles hide navigation

[[cascading-indentation]]
=== Cascading indentation

Each structural level contributes a `padding-left` to its `<div>`, creating a hanging indent for its label.
The label (number or letter) is pulled back into the gutter via negative `margin-left`.
Because child elements are placed inside the parent's content area (after the padding), each child's label naturally starts at the parent's *text* position — not the parent's *label* position.

The CSS custom properties are:

[cols="2,3,2", options="header"]
|===
| CSS property | Set on | Computed from

| `--lawgr-sub-num-width`
| `div.lawgr-subarticle`
| Max subarticle label width (e.g. "5.2" → 4.6ch)

| `--lawgr-custom-num-width`
| `div.lawgr-custom`
| Max custom label width (e.g. "Α" → 2.6ch)

| `--lawgr-num-width`
| `div.lawgr-paragraph`
| Max paragraph label width per segment depth (e.g. "5.2.8.1" → 9.6ch)
|===

Width computation formula: `label.length + 1.6` (1 char for trailing period + 0.6ch gap).
All widths are pre-computed by `precompute_paragraph_widths` before any `clause_attrs` calls.

Example cascade for Article 5, Subarticle 5.2:

----
x=0       5.2. Ασφάλεια Λογικής Πρόσβασης      (sub-num-width: 4.6ch)
x=4.6ch     Α. Λογική Πρόσβαση στα ΠΕΣ         (custom-num-width: 2.6ch)
x=7.2ch       5.2.1. Content text...             (num-width: 7.6ch)
x=14.8ch        5.2.8.1. Title...                (num-width: 9.6ch)
x=24.4ch          5.2.8.1.1. Content text...     (num-width: 10.6ch)
----

=== Apostrophes in AsciiDoc source

In AsciiDoc, the backtick-apostrophe sequence (pass:[`']) is a smart-quote marker for a right single quotation mark.
However, when two such sequences appear on the same line, the parser may misinterpret the backticks as monospace delimiters, wrapping the intervening text in `<tt>` tags.

To avoid this, use the Unicode right single quotation mark (U+2019, `'`) directly in the source:

----
// WRONG — may trigger monospace interpretation:
της υπ`' αρ. 165/2011 ... (Β`' 2715)

// CORRECT — literal Unicode apostrophe:
της υπ' αρ. 165/2011 ... (Β' 2715)
----


== Cross-references

=== Internal references

Standard Metanorma `xref` targeting element IDs:

[source,asciidoc]
----
<<art-5-para-1>>
----

Rendered as: "Παράγραφος 1 του Άρθρου 5" (or abbreviated per context).

The `IsoDoc::Lawgr::Xref` class overrides `main_anchor_names` and provides `lawgr_article_names` / `lawgr_paragraph_names` to produce Greek law reference labels using the i18n labels.

=== Law-to-law references

References to other Greek laws use standard Metanorma `eref` with manually authored bibliography entries.
No external Relaton database fetching.

[source,asciidoc]
----
[bibliography]
== Παραπομπές

* [[[law-4172-2013,Ν. 4172/2013]]] Ν. 4172/2013 (Α' 167)
* [[[law-2859-2000,Ν. 2859/2000]]] Ν. 2859/2000

// In text:
Σύμφωνα με το <<law-4172-2013,clause=72>>...
----


[[edafio-annotation]]
== Εδάφιο (sentence-level) annotation

Εδάφια annotations are invisible in the rendered output — the document renders exactly as it would without them.


=== Background

Greek law's lowest level of structure is the *εδάφιο* (informally *περίοδος*): a single grammatical sentence, typically delimited by a full stop.
Amendments and legal commentary routinely reference specific εδάφια, e.g. "το δεύτερο εδάφιο της παρ. 3 του άρθρου 9".

Automated sentence-boundary detection by punctuation is unreliable: the full stop appears in law references ("ν. 1234/2022"), abbreviations, and initialisms.
Instead, metanorma-lawgr uses *source line breaks* as εδάφιο delimiters.
In AsciiDoc, single line breaks within a paragraph block are semantically meaningless — they are joined with a space in the output — so repurposing them as εδάφιο boundaries introduces zero visual change.


=== Scope

An *eligible clause* for εδάφιο processing is one of:

. *Paragraph clause* — `<clause type="paragraph">`, regardless of nesting depth or whether paragraph numbering is suppressed (single-paragraph articles).
. *Article or subarticle without paragraph children (implicit p1)* — `<clause type="article">` or `<clause type="subarticle">` that has no `<clause type="paragraph">` children. The direct body content is treated as if it belonged to a single implicit paragraph (p1).

The structures that are broken down into εδάφια are exclusively:

. *Body text of eligible clauses* — direct `<p>` children of any eligible clause.
. *Ordered list items* — `<p>` children of `<li>` elements within eligible clauses, regardless of list nesting level.

The following are *not* subject to εδάφιο annotation:

* Titles / headings of any structural element (article, subarticle, custom, paragraph, etc.)
* Content outside eligible clauses (e.g. preface, bibliography, articles that have paragraph children)
* Unordered list items


==== Single AsciiDoc paragraph constraint

Current style specifications (ΕΓΧΕΙΡΙΔΙΟ ΜΕΘΟΔΟΛΟΓΙΑΣ ΓΙΑ ΤΗΝ ΚΩΔΙΚΟΠΟΙΗΣΗ ΤΗΣ ΝΟΜΟΘΕΣΙΑΣ 2020) do not allow more than one AsciiDoc paragraph block within a single lawgr paragraph.
Without lists, a `<clause type="paragraph">` contains exactly one `<p>` element; all εδάφια within it are delimited by `<eb/>` markers (from source line breaks).

This processor does not enforce this constraint, and allows any number of AsciiDoc paragraphs within a lawgr paragraph. This is not uncommon in practice, especially for older laws. In this case, εδάφια are numbered contiguously across all `<p>` children of the clause (numbering is not restarted for each `<p>`).


=== Numbering

Εδάφια are numbered with *Arabic numerals* (1, 2, 3…) internally for identification, scoped to their immediate parent:

* For paragraph body text: numbered sequentially across all direct `<p>` children of the eligible clause (contiguous numbering even when lists intervene).
* For articles/subarticles without paragraphs (implicit p1): same as paragraph body text, using `p1` as the paragraph segment in the quick-ref tag.
* For list items: numbered sequentially within each `<li>`.

When cited in cross-references, εδάφια are rendered as *ordinal words* (πρώτο, δεύτερο, τρίτο…) per the official legislative drafting guidelines (see <<cross-reference-labels>>).


[[cross-reference-labels]]
=== Cross-reference labels

Labels follow the standardised citation order prescribed by legislative drafting guidelines (Εγχειρίδιο Νομοπαρασκευαστικής Μεθοδολογίας and ΕΓΧΕΙΡΙΔΙΟ ΜΕΘΟΔΟΛΟΓΙΑΣ ΓΙΑ ΤΗΝ ΚΩΔΙΚΟΠΟΙΗΣΗ ΤΗΣ ΝΟΜΟΘΕΣΙΑΣ):

____
εδάφιο → στοιχείο → υποπερίπτωση → περίπτωση → παράγραφος → άρθρο
____

Each subdivision is cited in genitive case, building from innermost to outermost scope:

[cols="2,2,3",options="header"]
|===
| Subdivision | Citation form | Numbering

| εδάφιο | _τακτικό_ εδάφιο | ordinal word (πρώτο, δεύτερο, τρίτο…)
| στοιχείο | του στοιχείου _x_ | lowerroman (i, ii, iii…)
| υποπερίπτωση | της υποπερ. _x_ | doublegreek (γα, γβ…)
| περίπτωση | της περ. _x_ | lowergreek (α, β, γ…)
| παράγραφος | της παρ. _n_ | Arabic (1, 2, 3…)
| άρθρο | του άρθρου _n_ | Arabic (1, 2, 3…)
|===


==== Εδάφιο ordinal words

Εδάφια are cited using Greek ordinal words in neuter gender, lowercase.
The implementation uses a hardcoded table derived from `GreekNumerals::BOOK_ORDINALS` (downcased):

____
πρώτο, δεύτερο, τρίτο, τέταρτο, πέμπτο, έκτο, έβδομο, όγδοο, ένατο, δέκατο
____

Proper support to construct any ordinal words in Greek should be implemented at some point in the future, however.


==== Label examples

Articles, prepositions etc should not be part of the label, as the author should be able to choose freely when citing depending on the context. A definite article (in parentheses) is used in the examples for clarity.

When an "υποπερίπτωση" is cited, in theory the "περίπτωση" level could be ommited, as `[doublegreek]` notation conveys this information already. However, we will not implement this at this stage for simplicity.

Paragraph-level εδάφιο, multi-paragraph article::
  *(το) δεύτερο εδάφιο της παρ. 2 του άρθρου 5* +
  Quick-ref tag: `a5p2e2`

Paragraph-level εδάφιο, single-paragraph article or article without explicit paragraphs (implicit p1)::
  *(το) δεύτερο εδάφιο του άρθρου 5* +
  Quick-ref tag: `a5p1e2` +
  NOTE: The `p1` segment is always present — whether the paragraph clause exists (single-paragraph article) or is implicit (article without paragraph children).

Εδάφιο in level-1 list item (περίπτωση)::
  *(το) δεύτερο εδάφιο της περ. γ της παρ. 3 του άρθρου 9* +
  Quick-ref tag: `a9p3li3e2`

Εδάφιο in level-2 list item (υποπερίπτωση)::
  *(το) πρώτο εδάφιο της υποπερ. γα της παρ. 3 του άρθρου 9* +
  Quick-ref tag: `a9p3li3li1e1` +
  NOTE: doublegreek rendering is not yet implemented, but at this processing stage the full list tree is available.

Εδάφιο in level-3 list item (στοιχείο)::
  *(το) πρώτο εδάφιο του στοιχείου iv της υποπερ. γα της περ. γ της παρ. 3 του άρθρου 9* +
  Quick-ref tag: `a9p3li3li1li4e1`

Εδάφιο in paragraph under subarticle::
  *(το) δεύτερο εδάφιο της παρ. 3.1.5 του άρθρου 3* +
  Quick-ref tag: `a3.1p5e2` +
  Subarticle 1 extends the `a` segment; paragraph 5 is in the `p` segment.

Εδάφιο numbering is list-item-scoped.
One ordered list per lawgr paragraph is assumed for cross-referencing purposes.

εδάφιο tags and structured clause IDs share a *unified numbering scheme* (see <<structured-clause-ids>>):

* Both `article` and `subarticle` contribute to the *`a` segment* with dot notation (e.g. `a3.1`).
  Article numbering is contiguous across the entire document, matching the human-readable rendering.
* Only `type="paragraph"` clauses contribute to the *`p` segment* (e.g. `p5`).
  Paragraph numbering restarts when a higher-level type is encountered (article, subarticle).
  Nested paragraphs add dot-separated levels (e.g. `p1.2`).
  When an article or subarticle has no paragraph children, an implicit `p1` is used.
* εδάφιο tags start at the *article level* and omit higher-level structural prefixes (book, part, tmima, chapter).
  Structured clause IDs include the full hierarchy.


=== Examples

==== Example 1 — single εδάφιο

[source,asciidoc]
----
[heading=article]
=== Σκοπός -- Πεδίο Εφαρμογής

[heading=paragraph]
==== {empty}

Με τον παρόντα Κανονισμό καθορίζονται τα τεχνικά και οργανωτικά μέτρα που πρέπει να λαμβάνουν όλα τα πρόσωπα που παρέχουν δημόσια δίκτυα ηλεκτρονικών επικοινωνιών ή διαθέσιμες στο κοινό υπηρεσίες ηλεκτρονικών επικοινωνιών (εφεξής καλούμενοι για λόγους συντομίας «οι πάροχοι»), για τη διασφάλιση του απορρήτου των επικοινωνιών, με την κατάλληλη διαχείριση του κινδύνου όσον αφορά στην ασφάλεια των δικτύων και υπηρεσιών τους.
----

* The heading `=== Σκοπός -- Πεδίο Εφαρμογής` is a title — no εδάφια.
* The paragraph body is a single source line — *one εδάφιο* (εδάφιο 1).
* Output is unchanged.


==== Example 2 — paragraph with lists and continuation

[source,asciidoc]
----
[heading=paragraph]
==== {empty}

Οι υπόχρεοι οφείλουν να:

. κάνουν το ένα
. κάνουν το άλλο
. κάνουν και το παράλλο
+
Tο παράλλο κρίνεται ιδιαίτερα σημαντικό επειδή λόγος.
Επιπρόσθετα δεν μπορούν να μην το κάνουν.

Θα πρέπει επίσης να λάβουν υπόψη:

[start=4]
. ένα ονοματικό σύνολο
. και ένα δεύτερο ονοματικό σύνολο
----

Rendered output (arabic numberals for clarity, — εδάφια are invisible):

====
*(Αριθμός Παραγράφου)* Οι υπόχρεοι οφείλουν να:

. κάνουν το ένα
. κάνουν το άλλο
. κάνουν και το παράλλο.
+
Tο παράλλο κρίνεται ιδιαίτερα σημαντικό επειδή λόγος.
Επιπρόσθετα δεν μπορούν να μην το κάνουν.

Θα πρέπει επίσης να λάβουν υπόψη:

[start=4]
. ένα ονοματικό σύνολο
. και ένα δεύτερο ονοματικό σύνολο
====


===== Εδάφια in paragraph body

The paragraph clause contains two direct `<p>` elements (separated by the first ordered list block). Each is one εδάφιο:

[cols="1,6",options="header"]
|===
| # | Text
| 1 | Οι υπόχρεοι οφείλουν να:
| 2 | Θα πρέπει επίσης να λάβουν υπόψη:
|===


===== Εδάφια in ordered list items

The block contains two `<ol>` elements. Note item 3 comprises of a more complex structure through the employment of list continuation.
Because the second list uses `[start=4]` with contiguous numbering from the first list (which has 3 items), they are treated as a single logical list.

[cols="1,1,1,5",options="header"]
|===
| Item | Εδ. # | Source | Text

| 1 | 1 | single line | κάνουν το ένα
| 2 | 1 | single line | κάνουν το άλλο
| 3 | 1 | first content line | κάνουν και το παράλλο
| 3 | 2 | line after continuation | Tο παράλλο κρίνεται ιδιαίτερα σημαντικό επειδή λόγος.
| 3 | 3 | line break in continuation | Επιπρόσθετα δεν μπορούν να μην το κάνουν.
| 4 | 1 | single line | ένα ονοματικό σύνολο
| 5 | 1 | single line | και ένα δεύτερο ονοματικό σύνολο
|===

Source lines consisting only of whitespace and/or the `+` character (e.g. the bare ` +` continuation line in item 3) are formatting artifacts and are not counted as εδάφια.

If the second list restarted numbering at 1 (no `[start=]` or `[start=1]`), it would be treated as a separate list, and its items would be numbered independently.


==== Example 3 — explicit author markup (block-level)

When automatic line-break detection is insufficient — for example when an εδάφιο spans introductory text, an ordered list, and trailing text — the author can use block-level `[.ed]` open blocks to group content into a single εδάφιο.

===== Multi-block εδάφιο with trailing text

A common pattern in Greek law: introductory text followed by a list of obligations, with trailing text that completes the sentence but does not start a new εδάφιο (signalled by lowercase initial).

[source,asciidoc]
----
[heading=paragraph]
==== {empty}

[.ed]
--
Κατά το στάδιο της Προμήθειας/Ανάπτυξης... ο πάροχος:

. Πραγματοποιεί αρχικά Αποτίμηση Κινδύνου...
. συντάσσει κατάλογο...
.. κανόνων ασφάλειας...
.. ελάχιστων κανόνων...
.. παραμέτρων διαμόρφωσης...

ώστε να επιτυγχάνεται η συμμόρφωση...
--

Οι ως άνω κανόνες γίνονται αποδεκτοί...
----

The `[.ed]` open block (delimited by `--`) groups its entire content — introductory `<p>`, `<ol>`, and trailing `<p>` — into a single εδάφιο (e1).
The paragraph after the block is a separate εδάφιο (e2), detected automatically.

[cols="1,5",options="header"]
|===
| ID | Content
| e1 | The entire open block: intro text + list + trailing text
| e1li1 | Πραγματοποιεί αρχικά Αποτίμηση Κινδύνου...
| e1li2 | συντάσσει κατάλογο...
| e1li2li1 | κανόνων ασφάλειας...
| e1li2li2 | ελάχιστων κανόνων...
| e1li2li3 | παραμέτρων διαμόρφωσης...
| e2 | Οι ως άνω κανόνες γίνονται αποδεκτοί...
|===

===== Inline list items modelled as block lists

When the original law text contains inline enumerations (e.g. (α)... (β)... (γ)...), model them as proper AsciiDoc ordered lists inside an `[.ed]` open block:

[source,asciidoc]
----
[heading=paragraph]
==== {empty}

[.ed]
--
Ο πάροχος καταρτίζει... μηχανισμούς και συστήματα

. περιγράφεται ο λογικός διαχωρισμός...,
. περιγράφεται η αρχιτεκτονική... και
. καταγράφονται όλα τα ΠΕΣ...
--

Ο πάροχος διατηρεί τις προηγούμενες εκδόσεις...
----

[cols="1,5",options="header"]
|===
| ID | Content
| e1 | Ο πάροχος καταρτίζει... (including the list)
| e1li1 | περιγράφεται ο λογικός διαχωρισμός...
| e1li2 | περιγράφεται η αρχιτεκτονική...
| e1li3 | καταγράφονται όλα τα ΠΕΣ...
| e2 | Ο πάροχος διατηρεί τις προηγούμενες εκδόσεις...
|===

When `[.ed]` open blocks are present in a paragraph clause, the TreeProcessor skips automatic line-break processing for all blocks inside the open block — the author has taken full control of εδάφιο boundaries within those blocks.
The open block produces a temporary `<edafio-group>` wrapper in the XML, which the cleanup phase uses to number the group as a single εδάφιο, then unwraps (see <<xml-representation>>).

NOTE: For the rare case where a list item inside an `[.ed]` open block needs multiple εδάφια (where lines breaks would normally be used outside an explicit open block for automatic εδάφιο detection), use inline `[.ed]#text#` spans within that list item to mark explicit boundaries: `.. [.ed]#First εδάφιο.# [.ed]#Second εδάφιο.#`


=== Implementation

==== Architecture overview

The εδάφιο feature is implemented across three pipeline stages:

. *Asciidoctor TreeProcessor* — captures line-break boundaries from the parsed AST before they are lost
. *Custom inline macro* — produces an invisible boundary marker in the XML
. *XML cleanup* — scopes, numbers, and assigns IDs to εδάφια

This avoids a source-level preprocessor, which cannot know AST context and risks breaking inline markup that spans line breaks.


==== Stage 1: TreeProcessor

An Asciidoctor `TreeProcessor` extension runs after the document AST is fully parsed but before conversion to Standoc XML.

For every paragraph block (`:paragraph` context) and list-item block in the AST:

. If the block is inside an `[.ed]` open block, or contains inline `[.ed]` role spans, *skip it* — the author controls εδάφιο boundaries.
. Otherwise, examine `block.lines` (the original source lines, preserved in the AST).
. If the block has more than one content line, insert an `eb:[]` inline macro between content lines.

===== Line-break insertion rules

Given source lines `L1`, `L2`, …, `Ln`:

* If `Li` ends with ` +` (hard line break), the marker is prepended to the *next* content line: `eb:[] L(i+1)`. The ` +` must remain at end-of-line for AsciiDoc to recognise it.
* If `Li` does NOT end with ` +`, the marker is appended to `Li`: `Li eb:[]`.
* Lines consisting only of whitespace and/or `+` are skipped — they are continuation formatting, not εδάφιο boundaries.
* No marker is added after the last content line.

===== Example transformation

Source lines in AST node:
----
["κάνουν και το παράλλο +",
 " +",
 "Tο παράλλο κρίνεται ιδιαίτερα σημαντικό.",
 "Επιπρόσθετα δεν μπορούν να μην το κάνουν."]
----

After TreeProcessor:
----
["κάνουν και το παράλλο +",
 " +",
 "eb:[] Tο παράλλο κρίνεται ιδιαίτερα σημαντικό. eb:[]",
 "Επιπρόσθετα δεν μπορούν να μην το κάνουν."]
----

Two markers → three εδάφια in this list item.

===== Inline markup safety

Because markers are inserted *between* lines (not wrapped around them), inline markup spanning line breaks is unaffected:

[source,asciidoc]
----
This is *bold text that
continues here*.
----

Becomes:

----
This is *bold text that eb:[]
continues here*.
----

The `\*...*` delimiters still match. The `eb:[]` macro is an inline element inside the bold span — invisible in output.


==== Stage 2: Inline macro extension

Register `eb` as a custom Asciidoctor inline macro:

[source,ruby]
----
class EbInlineMacro < Asciidoctor::Extensions::InlineMacroProcessor
  named :eb
  def process(parent, target, attrs)
    # Produces <eb/> in the Standoc XML
  end
end
----

[[xml-representation]]
==== XML representation

A custom element `<eb/>` (short for εδάφιο break) is added to the lawgr RelaxNG schema.
It is a self-closing empty element that marks the boundary between two consecutive εδάφια within the same `<p>`.

Example Standoc XML fragment for a paragraph with two εδάφια:

Before cleanup:

[source,xml]
----
<clause type="paragraph">
  <p>Πρώτο εδάφιο. <eb/> Δεύτερο εδάφιο.</p>
</clause>
----

After cleanup (IDs and numbering assigned):

[source,xml]
----
<clause type="paragraph" id="a1p1">
  <p edafio-count="2">
    <eb edafio-n="1" id="a1p1e1"/>Πρώτο εδάφιο.
    <eb edafio-n="2" id="a1p1e2"/> Δεύτερο εδάφιο.
  </p>
</clause>
----

NOTE: The first εδάφιο in each `<p>` also receives an `<eb>` marker (inserted at the start of the `<p>` content), so all εδάφια — including the first — are uniformly represented by `<eb>` elements with `id` and `edafio-n` attributes.

For paragraph body text split by block elements (e.g. an ordered list between two `<p>` elements), no `<eb/>` is needed — the `<p>` elements are themselves distinct εδάφια.

When the author uses `[.ed]` open blocks, the converter wraps the block content in a temporary `<edafio-group>` element.
During cleanup, all `<p>` elements inside the group are treated as a single εδάφιο — only the first `<p>` receives an `<eb/>` marker.
After numbering, the `<edafio-group>` wrapper is unwrapped (children moved to parent, wrapper removed), so it does not appear in the final XML.

Before cleanup (with explicit `[.ed]` open block):

[source,xml]
----
<clause type="paragraph">
  <edafio-group>
    <p>Introductory text:</p>
    <ol><li><p>item α</p></li><li><p>item β</p></li></ol>
    <p>trailing text.</p>
  </edafio-group>
  <p>Next εδάφιο.</p>
</clause>
----

After cleanup (group unwrapped, IDs assigned):

[source,xml]
----
<clause type="paragraph" id="a1p1">
  <p><eb edafio-n="1" id="a1p1e1"/>Introductory text:</p>
  <ol><li><p><eb edafio-n="1" id="a1p1li1e1"/>item α</p></li>
      <li><p><eb edafio-n="1" id="a1p1li2e1"/>item β</p></li></ol>
  <p>trailing text.</p>
  <p edafio-count="2"><eb edafio-n="2" id="a1p1e2"/>Next εδάφιο.</p>
</clause>
----

NOTE: The trailing `<p>` inside the group does *not* receive its own `<eb/>` marker — it is a continuation of e1. It renders as a separate HTML paragraph but belongs to the same εδάφιο structurally.


==== Stage 3: XML cleanup

In `cleanup.rb`, after the full Standoc XML is built:

. *Strip out-of-scope markers:* Remove `<eb/>` elements that appear outside eligible clauses (paragraph clauses, and articles/subarticles without paragraph children) and outside `<li>` elements within those clauses.

. *Count εδάφια per parent:*
* For each eligible clause: each direct `<p>` child contributes 1 + (number of `<eb/>` markers it contains) εδάφια.
* For each `<li>`: same logic on its `<p>` children.

. *Contiguous list merging:* When two consecutive `<ol>` elements within the same eligible clause have contiguous numbering (second list's `start` attribute equals first list's item count + 1), treat them as a single logical list for εδάφιο cross-referencing.

. *Assign IDs:* Each εδάφιο receives a structured quick-ref ID (e.g. `a5p2e2`) derived from its enclosing article index, paragraph path (dot notation), and sequential εδάφιο number. An `<eb>` marker is inserted at the start of each `<p>` for the first εδάφιο, and existing `<eb/>` markers receive IDs for subsequent εδάφια. For `<edafio-group>` wrappers, the entire group counts as one εδάφιο — only the first `<p>` inside the group receives an `<eb>` marker. All εδάφια are thus uniformly represented by `<eb>` elements.

. *Unwrap groups:* After numbering, `<edafio-group>` wrapper elements are removed: their children are moved to the parent element. This ensures `<edafio-group>` does not appear in the final XML or affect schema validation.


==== Xref integration

`IsoDoc::Lawgr::Xref` generates εδάφιο anchors and labels in the numbering phase.
For paragraph clauses, anchors are registered via `lawgr_paragraph_anchor`.
For articles and subarticles without paragraph children (implicit p1), anchors are registered directly after child processing in `lawgr_article_names` and `lawgr_subarticle_names`.
Labels follow the patterns defined in <<cross-reference-labels>>.


==== HTML rendering

In the HTML output, `<eb/>` elements are rendered as invisible anchor points.
The `parse` method in `IsoDoc::Lawgr::BaseConvert` is overridden to dispatch `<eb/>` elements to a custom `eb_parse` method, which renders them as empty `<a>` elements:

[source,html]
----
<a id="a5p2e2"></a>
----

These anchors are invisible but serve as targets for cross-references and URL fragments (e.g. `document.html#a5p2e2`).


==== Unsupported constructs

The following AsciiDoc features are incompatible with line-break-based εδάφιο detection and must produce an *error* when encountered in a lawgr document:

* `[%hardbreaks]` option on any block
* `:hardbreaks-option:` document attribute
* `[verse]` blocks within paragraph clauses

These constructs repurpose line breaks for visual formatting, making it impossible to distinguish author formatting from εδάφιο boundaries.


==== Schema changes

The lawgr RelaxNG schema (`lawgr.rnc`) is extended with:

[source,rnc]
----
eb = element eb {
  attribute id { xsd:ID }?,
  attribute edafio-n { text }?
}
----

The `id` attribute receives the structured quick-ref tag (e.g. `a5p2e2`).
The `edafio-n` attribute carries the sequential εδάφιο number within its parent scope.
This element is permitted as inline content within `<p>` elements.

==== Warning

This feature may break things, we should be ready for a revert at any point.


=== Authoring guide

==== Default: line breaks as εδάφιο boundaries

Write one εδάφιο per source line within a paragraph or list item.
Single line breaks are used as εδάφιο delimiters — they have no effect on the rendered output.

[source,asciidoc]
----
[heading=paragraph]
==== {empty}

Πρώτο εδάφιο.
Δεύτερο εδάφιο.
Τρίτο εδάφιο.
----

This produces three εδάφια in a single rendered paragraph: "Πρώτο εδάφιο. Δεύτερο εδάφιο. Τρίτο εδάφιο."

Hard line breaks are preserved:

[source,asciidoc]
----
Πρώτο εδάφιο. +
Δεύτερο εδάφιο.
----

This renders with a visual line break between the two εδάφια, exactly as standard AsciiDoc.


==== Explicit markup: `[.ed]` open blocks

For complex cases where line-break detection produces incorrect results — such as an εδάφιο spanning introductory text, an ordered list, and trailing text — use `[.ed]` open blocks to group content into a single εδάφιο:

[source,asciidoc]
----
[.ed]
--
Introductory text:

. List item α
. List item β

Trailing text that continues the εδάφιο.
--

Next εδάφιο (auto-detected).
----

Everything inside the open block (`--` delimiters) is treated as *one* εδάφιο.
List items within the block still receive their own `li` sub-references.
Automatic line-break processing is *disabled* for all blocks inside the open block.

IMPORTANT: Do not nest `[.ed]` open blocks inside each other. Each open block corresponds to exactly one εδάφιο.

NOTE: For the rare case where a list item inside an `[.ed]` open block has multiple lines that should be separate εδάφια, use inline `[.ed]#text#` spans: `.. [.ed]#First εδάφιο.# [.ed]#Second εδάφιο.#`


==== List items with continuation

For list items with multiple εδάφια, use list continuation (`\+`) to add content lines.
Each content line (after excluding blank/`+`-only lines) is an εδάφιο:

[source,asciidoc]
----
. Πρώτο εδάφιο στοιχείου.
+
Δεύτερο εδάφιο στοιχείου.
Τρίτο εδάφιο στοιχείου.
----

This list item has three εδάφια.
The bare ` +` line is a formatting artifact and is ignored.


[[structured-clause-ids]]
== Structured Clause IDs

In addition to εδάφιο annotation, metanorma-lawgr replaces the default UUID-based clause IDs with human-readable structured IDs that encode each clause's position in the document hierarchy.
This runs during `sections_cleanup`, after `heading_to_type` converts AsciiDoc heading attributes to clause types, and before εδάφιο cleanup.


=== Prefix mapping

[cols="2,1,3",options="header"]
|===
| Clause type | Prefix | Example

| `book` | `b` | `b1`
| `part` | `pt` | `pt2`
| `tmima` | `t` | `t1`
| `chapter` | `c` | `c3`
| `article` | `a` | `a5`
| `subarticle` | _(dot notation)_ | `a5.1`
| `paragraph` | `p` | `a5.1p3`
|===


=== Composition rules

Structured IDs are composed by concatenating three segments:

. *Higher-level prefix* — book (`b`), part (`pt`), tmima (`t`), chapter (`c`): each contributes its prefix and 1-based position among same-type siblings within its parent.
. *Article segment* (`a`) — article + subarticle positions joined with dots. Article numbering is *contiguous across the entire document* (not restarted per part/chapter), matching the human-readable rendering.
. *Paragraph segment* (`p`) — paragraph positions joined with dots. Paragraph numbering restarts at each article or subarticle boundary. Nested paragraphs add additional dot-separated levels.

Additional rules:

* *Custom* clauses (non-normative grouping headings like Α., Β., Γ.) are *transparent*: they do not contribute a path segment and retain their UUID-based IDs. Their structural children are counted at the nearest structural ancestor level.
* Clause types not in the prefix mapping (e.g. semantic types like `entry-into-force`) are also treated as transparent.
* Only clauses with a recognised structural type receive structured IDs. Transparent clauses keep their original UUIDs.


=== Structured ID examples

[cols="3,2",options="header"]
|===
| Structural path | ID

| Part 2 | `pt2`
| Article 3 within Part 2 | `pt2a3`
| Subarticle 1 of Article 3 within Part 2 | `pt2a3.1`
| Paragraph 5 within that subarticle | `pt2a3.1p5`
| Tmima 1 within Part 1 | `pt1t1`
| Article 1 within Chapter 2 of Book 3 | `b3c2a1`
| Full hierarchy (unlikely) | `b1pt1t1c1a1.1p1`
|===


=== Relationship to εδάφιο tags

Structured clause IDs and εδάφιο quick-ref tags share the *same unified numbering scheme*.  The only difference is scope:

* *Clause IDs* include the full hierarchy from root: `pt2a3.1p5`.
* *Εδάφιο tags* omit the higher-level prefix and start at the article segment: `a3.1p5e2`.

Both use contiguous document-wide article numbering and the same paragraph restart semantics.
The `clause_structured_path` method in `cleanup.rb` is the single source of truth for both systems.


=== Cross-reference updating

When clause IDs are replaced, all attribute values in the document that match an old UUID are updated to the corresponding new structured ID.
This covers `xref target`, `origin bibitemid`, `source`, and any other attribute that referenced the clause by its original UUID.


== Gem structure

[source]
----
metanorma-lawgr/
├── metanorma-lawgr.gemspec
├── lib/
│   ├── metanorma-lawgr.rb              # entry point, registry registration
│   ├── metanorma/
│   │   ├── lawgr.rb                     # module definition
│   │   └── lawgr/
│   │       ├── version.rb
│   │       ├── processor.rb             # Metanorma::Lawgr::Processor
│   │       ├── converter.rb             # requires all converter modules
│   │       ├── base.rb                  # XML_ROOT_TAG, html_converter, etc.
│   │       ├── front.rb                 # metadata extraction from doc header
│   │       ├── section.rb               # section type dispatch overrides
│   │       ├── cleanup.rb               # section ordering, structured IDs, εδάφιο cleanup
│   │       ├── edafio_tree_processor.rb  # TreeProcessor, EbInlineMacro, EdafioInline
│   │       ├── validate.rb              # structural validation
│   │       ├── greek_numerals.rb        # GreekNumerals utility module
│   │       ├── lawgr.rnc               # RelaxNG Compact grammar
│   │       ├── lawgr.rng               # compiled RelaxNG
│   │       ├── isodoc.rng              # base Metanorma grammar (copied)
│   │       ├── basicdoc.rng            # BasicDoc grammar (copied)
│   │       ├── biblio.rng              # Relaton grammar (copied)
│   │       ├── biblio-standoc.rng      # StanDoc biblio grammar (copied)
│   │       ├── relaton-lawgr.rng       # law-specific bibdata extensions
│   │       └── boilerplate.adoc        # (if needed)
│   └── isodoc/
│       └── lawgr/
│           ├── base_convert.rb
│           ├── html_convert.rb          # IsoDoc::Lawgr::HtmlConvert
│           # pdf_convert.rb             # IsoDoc::Lawgr::PdfConvert (deferred)
│           ├── presentation_xml_convert.rb
│           ├── presentation_xref.rb     # Greek law xref label generation
│           ├── xref.rb                  # IsoDoc::Lawgr::Xref
│           ├── metadata.rb
│           ├── i18n.rb
│           ├── i18n-el.yaml
│           ├── i18n-en.yaml
│           ├── init.rb
│           └── html/
│               ├── html_lawgr_titlepage.html
│               ├── html_lawgr_intro.html
│               ├── htmlstyle.css          # plain CSS (Inter font, nav sidebar, hanging-indent paragraphs, cascading indent)
│               └── scripts_override.html  # navbar toggle fix (body margin + button position sync)
├── spec/                                # RSpec tests
│   └── metanorma/
│       └── edafio_spec.rb           # εδάφιο annotation tests
└── Gemfile
----


== Prototype scope

=== In scope (MVP)

* Gem skeleton with Metanorma registry integration
* `Metanorma::Lawgr::Converter` inheriting from StanDoc, registered as `lawgr`
* Section type dispatch for the full Greek law hierarchy (Book through Paragraph) via `heading` attribute
* `heading` / `type` / `semantic-type` attribute separation
* Flat paragraph numbering within articles (default), with opt-in hierarchical numbering via `:inheritnumbering:`
* Greek numeral algorithm (`GreekNumerals` module) — utility implemented and integrated for περίπτωση (depth-1 ordered lists) via `list_item_value` override
* i18n labels (Greek and English)
* Custom clause type (`heading=custom`) with uppercase-Greek numbering, transparent to child paragraph numbering
* Structured clause IDs — human-readable hierarchy-based IDs replacing UUIDs on structural clauses (see <<structured-clause-ids>>)
* Εδάφιο (sentence-level) annotation — invisible sentence-level markers with numbering, structured IDs, and cross-references; automatic line-break detection and explicit `[.ed]` block markup (see <<edafio-annotation>>)
* HTML output with Inter font, navigation sidebar, hanging-indent paragraph layout, structural labels, cascading indentation via CSS custom properties
* Navigation sidebar with meaningful TOC entries ("Παράγραφος _n_" for untitled paragraphs via `variant-title` mechanism); toggle button with body margin override (`scripts_override.html`)
* Basic metadata extraction (law number, ΦΕΚ, date, type)
* CSS classes on clause divs (`lawgr-article`, `lawgr-paragraph`, `lawgr-custom`, etc.) for targeted styling; per-div CSS custom properties for cascading indent widths
* Deep paragraph support (h7/h8 elements) for nesting beyond HTML's h1–h6 limit
* Cover page template with ΦΕΚ publication metadata

=== Deferred

* PDF output
* Double-Greek ordered-list rendering for υποπερίπτωση (depth-2 lists: αα, αβ… βα, ββ…) — requires parent-ordinal threading through `list_item_anchor_names`
* Amendment authoring syntax
* Akoma Ntoso XML export
* Relaton database fetching
* Structural validation rules (continuous article numbering, etc.)
* Signer metadata extraction
* Internal cross-references (xref rendering)
* Word (`.doc`) output

=== Vision

* Amendment support should allow for:
** Generating any version of a law, incorporating all amendments up to an arbitrary date or amendment number (no skipping of amendments allowed, only omission of later amendments)
** Generating the amendment text as if it were to be published in the official gazzette of the republic
** Side-by-side comparison of two versions of a law, ISO redlines-like or github-style
*** rendering should relay a visual cue to easily identify deletions (e.g. white area in "after" view), changes (e.g. both "before" and "after" views have content at the same horizontal position), and insertions (e.g. white area in "before" view)
* Implementation of a db-backed bibliography and references system drawing inspiration from Relaton
** Potentially extend Relaton DB integration functionality to allow for quote extraction and citation generation, in addition to structural metadata extraction
** Some mechanism for the handling of references after amendments have been introduced:
*** auto-updating references to reflect the new law structure, when safe
**** even then, mark them as auto-updated, only a human reviewer can clear the review-required flag
*** mark reference as review-required when unsafe
*** reverse lookup of references impacted by an amendment
**** references should be date-tagged or version-tagged to allow for invalidation and auto-updating
* Produce Akomo-Ntoso compliant export of any entity that is an Akomo Ntoso target
** probably difficult to implement
** will likely require enrichment of document-level metadata and potential restructuring or one-to-one mapping of ontological entities between the two models
** kind of a holy grail for me though
* To the extent that the design of metanorma-lawgr can be useful to a wider ecosystem, incorporate anything that is scope-relevant and is needed to support the lifecycle of lawmaking:
** Drafting, reviewing, deliberation, approval, publication, repeal, etc.
** Facilitating the formation of a formal codex where:
*** the latest version of a law is always available both to humans (highly presentation-centric) and to machines (highly structure-centric)
*** dynamic presentation of codification nomenclature based on included metadata, e.g.:
**** codification tree based on legal subject
**** codification tree based on legislative body (parliament, regulator)
**** filter by law subject attributes, either self-provided or drawn from other government databases, for example:
***** law subject has a licence to engage in telecom services by EETT, so these laws apply to them
***** law subject owns property so these laws apply to them
****** some of their property is connected to the electrical grid, so these additional laws apply to them
****** hopefully you see where I'm getting with this by now
** single source of truth for all uses:
*** regulatory/legal compliance for law subjects with references and auto-alerting
*** machine-controlled derived outputs to include in legacy workflows (e.g. diavgeia, FEK, government websites etc.)
*** everything is available via API for consumption by other systems
*** integration with Case Management Systems for the modernization of the judicial process


== Other useful resources

* `codification-manual` — the Κ.Ε.Κ. codification methodology manual (2020) issued by the General Secretariat for Legal and Parliamentary Affairs (GSLegal).
** source: https://gslegal.gov.gr/wp-content/uploads/2022/10/%CE%A4%CE%B5%CE%BB%CE%B9%CE%BA%CF%8C-%CE%B5%CE%B3%CF%87%CE%B5%CE%B9%CF%81%CE%AF%CE%B4%CE%B9%CE%BF-%CE%BC%CE%B5%CE%B8%CE%BF%CE%B4%CE%BF%CE%BB%CE%BF%CE%B3%CE%AF%CE%B1%CF%82-%CE%BA%CF%89%CE%B4%CE%B9%CE%BA%CE%BF%CF%80%CE%BF%CE%AF%CE%B7%CF%83%CE%B7%CF%82.pdf[download]
* `LegalParser` — companion for the Panhellenic Conference on Informatics (PCI) 2016 paper _Towards Automatic Structuring and Semantic Indexing of Legal Documents_ (Koniaris, Papastefanatos, Vassiliou).
** source: https://github.com/mkoniari/LegalParser[github repo]
** No code provided, but useful for the EBNF grammar and parsing strategy.
** paper available at: http://dx.doi.org/10.1145/3003733.3003801[the ACM Digital Library]
** `samples/law_4330_2015.xml` — Akoma Ntoso 3.0 XML of Law 4330/2015, used as reference for metadata and structure mapping
