<script>
// lawgr: unified toggle handler for the navigation sidebar.
// The base isodoc script binds its own #toggle click handler that
// animates nav left + body marginLeft.  We remove it and replace
// with a single handler that also slides #toggle in sync and
// keeps a minimum body margin so content never overlaps the widget.
(function() {
  var jqToggle = $('#toggle');
  var jqNav = $('nav');
  var jqBody = $('body');
  if (!jqToggle.length || !jqNav.length) return;

  var navWidth = parseInt(jqNav.css('width')) || 278;
  var toggleWidth = jqToggle.outerWidth() || 30;
  var gap = parseInt(jqBody.css('margin-left')) - navWidth - toggleWidth;
  if (gap < 0) gap = 12;
  var speed = 'slow';

  // Remove base isodoc toggle handler to prevent double animation.
  jqToggle.off('click');

  jqToggle.on('click', function() {
    var isVisible = jqNav.is(':visible');

    var navLeft      = isVisible ? '-' + navWidth + 'px' : '0px';
    var toggleLeft   = isVisible ? '0px' : navWidth + 'px';
    var bodyMargin   = isVisible
      ? (toggleWidth + gap) + 'px'
      : (navWidth + toggleWidth + gap) + 'px';

    // Stop any in-flight animations.
    jqNav.stop(true, true);
    jqToggle.stop(true, true);
    jqBody.stop(true, true);

    // Show nav before sliding it in.
    if (!isVisible) { jqNav.show(); }

    // Slide nav, toggle, and body in sync.
    jqNav.animate({ left: navLeft }, speed, function() {
      if (isVisible) { jqNav.hide(); }
    });
    jqToggle.animate({ left: toggleLeft }, speed);
    jqBody.animate({ marginLeft: bodyMargin }, speed);

    var arrow = isVisible ? '\u25B6' : '\u25C0';
    jqToggle.find('span').text(arrow);
  });
})();
</script>
